# بوت الأرقام المجانية الاحترافي (nxrxbot-pro)

هذا المشروع هو إعادة بناء كاملة لبوت Telegram متقدم لإدارة نظام أرقام مجانية، مع ميزات متكاملة تشمل نظام PRO، نظام النقاط، نظام الإعلانات، ولوحة تحكم متطورة للمدير. تم تطويره باستخدام **Aiogram 3+** لضمان الأداء العالي والعمل غير المتزامن.

## 🌟 الميزات الرئيسية

1.  **نظام PRO متكامل:** إدارة اشتراكات المستخدمين، تفعيل بالنقاط أو أكواد، وصلاحيات خاصة.
2.  **نظام نقاط شامل:** كسب النقاط (مهام، دعوات، مشاهدة إعلانات)، إنفاق النقاط (شراء PRO، خدمات)، وسجل تاريخي دقيق.
3.  **إدارة الإعلانات:** إضافة، تعديل، حذف، وتتبع إعلانات نصية وصورية وفيديو، مع دعم نظام "المشاهدة مقابل النقاط".
4.  **إعداد أولي ذكي:** واجهة إعداد (Setup) للمدير عند التشغيل الأول لضبط الإعدادات الأساسية والقنوات الإلزامية.
5.  **جاهزية للنشر:** دعم كامل للـ Webhooks والنشر على منصات مثل **Render** باستخدام Docker و FastAPI.

## 🛠️ هيكل المشروع

تم تنظيم المشروع وفقًا لمبادئ **Clean Code** لسهولة الصيانة والتوسع:

| المجلد/الملف | الوصف |
| :--- | :--- |
| `main.py` | نقطة الدخول الرئيسية، إعداد الـ Webhooks/Polling، وتجميع المكونات. |
| `config.py` | تحميل متغيرات البيئة والإعدادات العامة. |
| `database.py` | طبقة الوصول للبيانات (DAL) وإدارة قاعدة البيانات (SQLite/PostgreSQL). |
| `handlers/` | معالجات الأوامر والرسائل (للمستخدم العادي والمدير). |
| `services/` | المنطق التجاري (Business Logic) للأنظمة الرئيسية (`ProManager`, `PointsManager`, `AdsManager`). |
| `utils/` | الأدوات المساعدة (مثل Logging، دوال الرد الآمن). |
| `Dockerfile` | ملف بناء صورة Docker للنشر. |
| `render.yaml` | ملف تكوين النشر على منصة Render. |
| `requirements.txt` | قائمة بمكتبات Python المطلوبة. |
| `.env.example` | مثال لمتغيرات البيئة المطلوبة. |

## 🚀 خطوات التشغيل والنشر

### 1. الإعداد المحلي (Polling)

للتشغيل المحلي، يفضل استخدام وضع الـ Polling.

1.  **استنساخ المشروع:**
    ```bash
    git clone <URL_للمشروع>
    cd nxrxbot-pro
    ```
2.  **إعداد البيئة:**
    ```bash
    # إنشاء بيئة افتراضية
    python3 -m venv venv
    source venv/bin/activate
    
    # تثبيت المتطلبات
    pip install -r requirements.txt
    ```
3.  **تكوين المتغيرات:**
    - انسخ ملف `.env.example` إلى ملف `.env`:
      ```bash
      cp .env.example .env
      ```
    - قم بتعديل ملف `.env` واملأ قيمة `BOT_TOKEN` و `ADMIN_ID`.
4.  **التشغيل:**
    ```bash
    python main.py
    ```
    (سيتم تشغيل البوت في وضع Polling افتراضيًا إذا لم يتم تحديد `WEBHOOK_URL`).

### 2. النشر على Render (Webhook)

للنشر على Render، يجب استخدام الـ Webhooks لضمان استمرارية العمل.

1.  **إعداد مستودع Git:**
    - ارفع الكود إلى مستودع Git خاص بك (GitHub/GitLab/Bitbucket).
2.  **تكوين Render:**
    - قم بإنشاء خدمة ويب جديدة (Web Service) في Render.
    - اربطها بمستودع Git الخاص بك.
    - اختر **Docker** كبيئة بناء (Build Environment).
    - سيقوم Render تلقائيًا بقراءة `Dockerfile` و `render.yaml`.
3.  **متغيرات البيئة:**
    - في إعدادات الخدمة على Render، قم بتعيين متغيرات البيئة التالية (من ملف `.env.example`):
      - `BOT_TOKEN`
      - `ADMIN_ID`
      - `WEBHOOK_SECRET` (سيتم توليده تلقائيًا إذا استخدمت `render.yaml`)
    - **ملاحظة:** سيقوم Render بتعيين متغير `WEBHOOK_URL` تلقائيًا.
4.  **التشغيل:**
    - عند النشر، سيقوم الأمر `uvicorn main:app --host 0.0.0.0 --port $PORT` بتشغيل البوت، وسيقوم الكود بضبط الـ Webhook تلقائيًا على عنوان الخدمة.

### 3. فحص الصحة (Health Check)

للتأكد من أن الخدمة تعمل بشكل صحيح على Render، يمكنك زيارة المسار التالي:

- **المسار:** `/healthz`
- **الاستجابة المتوقعة:** `{"status": "ok"}`
